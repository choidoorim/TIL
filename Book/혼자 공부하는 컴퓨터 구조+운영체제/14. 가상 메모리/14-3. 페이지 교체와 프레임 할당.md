# 14-3. 페이지 교체와 프레임 할당

## 요구 페이징

- 프로세스를 메모리에 적재할 때 모든 페이지를 적재하지 않고 필요한 페이지만을 메모리에 적재하는 기법이다.
- 메모리를 페이지에 적재하지 않고 실행할 수 있다. 첫 명령어 실행부터 페이지 폴트가 발생할 것이고, 실행에 필요한 페이지가 어느 정도 적재되면 이후에는 페이지 폴트 발생 빈도가 떨어질 것이다. 그리고 이것을 순수 요구 페이징(pure demand paging) 기법이라고 한다.
- 요구 페이징 시스템이 안정적으로 작동하기 위해서는 페이지 교체와 프레임 할당을 해결해야 한다.

### 페이지 교체

- 요구 페이징 기법을 사용하다보면 메모리가 가득차는 경우가 발생한다. 실행에 필요한 페이지를 메모리에 적재하기 위해서는 기존 메모리에 있는 페이지를 보조기억장치로 보내야 한다. 이 때, 어떤 페이지를 내보내야할지 결정하는 방법을 페이지 교체 알고리즘이라고 한다.

## 페이지 교체 알고리즘

- 페이지 폴트를 가장 적게 일으키는 알고리즘이 좋다.
- 페이지 폴트 횟수를 알아야 하고, 페이지 폴트 횟수는 페이지 참조열을 통해 알 수 있다. 페이지 참조열은 CPU 가 참조하는 페이지들 중에 연속되는 페이지를 생략한 페이지열이다.

    ```jsx
    2 2 2 3 5 5 5 3 3 7 -> 2 3 5 3 7
    ```

- 연속되는 페이지를 생략하는 이유는 중복된 페이지를 참조하는 것은 페이지 폴트를 발생시키지 않기 때문이다.

### FIFO 페이지 교체 알고리즘

- 메모리에 가장 먼저 올라온 페이지부터 내쫒는 방식이다.
- 구현이 간단하다는 장점이 있다. 하지만 프로그램 실행 내내 사용될 페이지들도 있을 수 있기 때문에 메모리에 먼저 적재되었다고 메모리에서 내쫒기게 된다는 단점이 있다.

### 최적 페이지 교체 알고리즘

- CPU 에 의해 참조되는 횟수를 고려하는 페이지 교체 알고리즘이다. 즉, 미래의 이용빈도가 낮은 페이지를 교체하는 알고리즘이다.
- 페이지 교체 알고리즘 중에 페이지 폴트 발생 빈도가 가장 낮다.
- 큰 장점이 있지만, 구현이 어렵다는 단점도 있다.

### LRU 페이지 교체 알고리즘

- 가장 오랫동안 사용되지 않은 페이지를 교체하는 알고리즘이다.
- 최근에 사용하지 않은 페이지는 앞으로도 사용되지 않을 것이라는 아이디어를 토대로 만들어진 알고리즘이다.

## 스래싱과 프레임 할당

- 프로세스가 사용할 수 있는 프레임 수가 적어도 페이지 폴트가 자주 발생한다.
- 프레임이 부족하다면 CPU 는 페이지 폴트가 자주 발생할 것이고, CPU 이용률도 떨어져 성능에 큰 악영향을 끼친다.
- **프로세스가 실행되는 시간보다 페이징에 더 많은 시간을 소요**하여 성능이 저해되는 문제를 스래싱(thrashing)이라고 한다.
- 메모리에서 동시 실행되는 프로세스 수를 멀티프로그래밍 정도(degree of multiprogramming)라고 한다.
- CPU 의 성능이 뛰어나도 동시에 실행되는 프로세스를 수용할 물리 메모리가 너무 작다면 전체 컴퓨터의 성능이 안 좋아진다.
- 스래싱이 발생하는 원인은 각 프로세스가 필요한 최소한의 프레임 수가 보장되지 않기 때문이다.
- 각 프로세스마다 균일하게 프레임을 할당하는 방식을 균일 할당(equal allocation) 이라고 한다. 프로세스 마다 실행되는 크기는 다르기 때문에 좋은 방식은 아니다.
- 프로세스의 크기에 따라 프레임을 나눠주는 방식을 비례 할당(proportional allocation) 이라고 한다. 하지만 프로세스 크기가 큰 프로세스를 실행해도 프레임이 적게 필요한 프로세스가 있을 수도 있기 때문에 좋은 방식이 아니다.
- 프로세스를 실행하는 과정에서 배분할 프레임을 결정하는 방식에는 작업 집합 모델을 사용하는 방식과 페이지 폴트 빈도를 사용하는 방식이 있다.

### 작업 집합 모델

- 실행 중인 프로세스가 일정 시간 동안 참조한 페이지의 집합을 작업 집합이라고 한다.
- CPU 가 과거에 주로 참조한 페이지를 **작업 집합에 포함하면 운영체제는 작업 집합의 크기만큼만 프레임을 할당**해주면 된다.
    - CPU 가 어떤 프로세스를 실행하는 동안 3초에 일곱 개의 페이지를 집중적으로 참조했다면 운영체제는 그 프로세스를 위해 그 순간만큼 최소 일곱 개의 프레임을 할당한다.

### 페이지 폴트 기반

- 페이지 폴트율에 상한선과 하한선을 정하고, 이 범위 안에서만 프레임을 할당하는 방식이다.
- 상한선보다 높아지면 그 프로세스는 너무 적은 프레임을 갖고 있기 때문에 프레임을 더 할당하고, 하한선보다 더 낮아지면 프레세스는 너무 많은 프레임을 가지고 있기 때문에 프레임을 회수한다.
