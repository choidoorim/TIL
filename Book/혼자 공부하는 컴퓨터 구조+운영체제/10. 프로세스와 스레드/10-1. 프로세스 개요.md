# 10-1. 프로세스 개요

## 프로세스 직접 확인하기

- 유닉스 체계 운영체제에서는 `ps` 명령어로 확인이 가능하다
- 사용자가 보는 앞에서 실행되는 프로세스를 포그라운드 프로세스 라고 하고, 사용자가 보지 못하는 뒤에서 실행되는 프로세스를 백그라운드 프로세스라고 한다.
- 백그라운드 프로세스 중에서는 **사용자와 상호작용을 하지 않고 묵묵히 정해진 일만 수행하는 백그라운드 프로세스**가 있는데 이것을 데몬이라고 한다(윈도우 OS 에서는 서비스라고 한다).

## 프로세스 제어 블록(PCB)

- CPU 의 자원은 한정되어 있다. 따라서 프로세스들은 차례대로 돌아가면서 한정된 시간만큼 CPU 를 사용한다. 운영체제는 프로세스의 실행 순서를 관리하고, CPU 를 비롯한 자원을 배분한다. 이를 위해서 운영체제는 프로세스 제어 블록(PCB: Process Control Block) 을 이용한다.
- PCB 는 프로세스와 관련된 정보를 저장하는 자료구조이다. 해당 프로세스를 식별하기 위해 꼭 필요한 정보들이 저장된다.
- PCB 는 커널 영역에 생성된다. 그리고 프로세스 생성 시에 PCB 가 만들어지고, 실행이 끝나면 폐기된다.

### PCB 에 담기는 정보들

- 프로세스 ID: 특정 프로세스를 식별하기 위해 부여하는 고유한 번호이다.
- 레지스터 값:  이전까지 사용했던 레지스터의 중간 값들을 모두 복원해서 이전까지 진행했던 작업들을 그대로 이어나갈 수 있게 한다. PCB 안에는 프로그램 카운터와 레지스터 값등이 담긴다.
- 프로세서 상태: 현재 프로세서가 대기 상태인지, 기다리는 상태인지 등이 기록되어 있다.
- CPU 스케쥴링 정보: 프로세서가 언제, 어떤 순서로 CPU 를 할당 받을지에 대한 정보도 PCB 에 기록된다.
- 메모리 관리 정보: 프로세스가 어느 메모리 주소에 저장되어 있는지에 대한 정보를 담는다.
- 사용한 파일과 입출력장치 목록: 프로세서 실행 과정에서 입출력 장치나 파일을 사용하면 PCB 에 해당 내용이 명시된다.

## 문맥교환

- CPU 를 사용할 수 있는 시간이 다 되어 다음 프로세스에게 CPU 를 양보하게 되면, 직전까지 실행되던 프로세스는 프로그램 카운터, 레지스터 값, 메모리 정보 등을 백업해야 한다. 그래야만 다음 차례에 이전까지 실행했던 내용을 이어서 실행할 수 있기 때문이다. 이렇게 **하나의 프로세스 수행을 재개하기 위해 기억해야 할 정보를 문맥(context)** 라고 한다.
- 프로세스 문맥은 해당 프로세스의 PCB 에 표현되어 있다. 다음 프로세스에게 CPU 를 넘겨줘야 할 때 운영체제는 해당 프로세스의 PCB 에 문맥을 백업한다. 그리고 다음 프로세스의 문맥을 복구한다. 이런 식으로 자연스럽게 프로세스들이 바뀐다. 새로운 프로세스를 실행하기 위해 문맥을 PCB 로부터 복구해서 새로운 프로세스를 실행하는 것을 문맥 교환(context switching) 이라고 한다.
- 문맥 교환이 자주 일어날 경우 오버헤드가 발생할 수 있다.

## 프로세스의 메모리 영역

- 하나의 프로세스는 사용자 영역에 코드/데이터/힙/스택 영역으로 나뉘어 저장된다.
- 코드 영역과 데이터 영역은 크기가 변하지 않는다. 그렇기에 크키가 고정된 영역이라는 점에서 **정적 할당 영역**이라고도 부른다.
- 힙 영역과 스택 영역은 프로세스 실행 과정에서 크기가 변할 수 있는 영역이기에 **동적 할당 영역**이라고 부른다.
- 힙 영역은 메모리에 데이터가 낮은 주소부터 높은 주소로, 스택 영역은 높은 주소부터 낮은 주소로 할당되어 **새롭게 할당되는 주소가 겹치지 않도록** 되어 있다.

### 코드영역

- 텍스트 영역이라고 하기도 한다.
- 실행할 수 있는 코드인 기계어로 이루어진 명령어가 저장된다.
- 데이터가 아닌 CPU 가 실행할 명령어가 담겨 있기 때문에 쓰기가 금지되어 있다. 즉, 읽기 전용이다.

### 데이터 영역

- 잠깐 사용되는 데이터가 아닌, 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간이다.
- 데이터로는 전역 변수가 대표적이다.

### 힙 영역

- 프로그램을 만드는 사용자인 **프로그래머가 직접 할당할 수 있는 저장 공간**이다.
- 프로그래밍 과정에서 힙 영역에 데이터를 할당했다면 언젠가는 해당 공간을 반환해야 한다. 메모리 공간을 반환하지 않는다면 할당한 공간이 메모리에 계속 남아 메모리가 낭비되는 문제인 메모리 누수가 발생한다.
- 메모리의 낮은 주소에서 높은 주소로 할당된다.

### 스택 영역

- 데이터를 일시적으로 저장하는 공간이다. 잠깐 쓰다가 말 값들이 저장되는 공간이다.
- 데이터로는 함수 실행 종료후 사라지는 매개 변수, 지역 변수가 대표적이다.
- 메모리의 높은 주소에서 낮은 주소로 할당된다.

