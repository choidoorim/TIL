# 9-2. 운영체제의 큰 그림

## 운영체제의 심장, 커널(Kernel)

- 자원에 접근하고 조작하는 기능, 프로그램이 올바르고 안전하게 실행되게 하는 기능이 운영체제의 핵심 서비스이다. 이러한 운영체제의 핵심 서비스를 담당하는 부분을 커널이라고 한다.
- 운영체제가 제공하는 서비스 중에 **커널에 포함되지 않는 것도 있는데, 바로 사용자 인터페이스(UI)** 이다. 사용자 인터페이스는 **사용자가 컴퓨터와 상호작용할 수 있는 통로**로 **그래픽 유저 인터페이스(GUI)와 커맨드 라인 인터페이스(CLI)** 가 있다.
    - 윈도우 운영체제를 사용할 때 마우스를 이용해 다양한 프로그램을 실행할 수 있는 것은 윈도우 운영체제가 그래픽 유저 인터페이스를 지원하기 때문이다.
    - 사용자가 컴퓨터를 사용하기 위해 정해진 명령어를 입력함으로써 컴퓨터와 상호작용을 하는 것은 커맨드 라인 인터페이스라고 한다.

## 이중 모드와 시스템 호출

- 운영체제는 응용 프로그램들이 CPU, 메모리, 하드디스크 등의 자원에 접근하려고 할 때 반드시 운영체제 자신을 통해서만 접근하도록하여 자원을 보호한다. 즉, 자원에 접근하기 위해서는 응용 프로그램이 운영체제에게 도움을 요청하고, 운영체제가 대신 자원에 접근하여 요청한 작업을 수행한다.
- 운영체제의 문지기 같은 역할은 이중 모드로 구현된다. 이중 모드(dual mode)란 **CPU 가 명령어를 실행하는 모드를 크게 사용자 모드와 커널 모드로 구분**하는 방식이다.
- 사용자 모드(user mode)는 운영체제 서비스를 제공받을 수 없는 실행 모드이다. 즉, 커널 영역의 코드를 실행할 수 없는 모드이다. 보통 응용 프로그램은 사용자 모드로 실행된다.
- 커널 모드(kernel mode)는 운영체제 서비스를 제공받을 수 있는 실행 모드이다. 즉, 커널 영역의 코드를 실행할 수 있는 모드이다. 운영체제는 커널 모드로 실행되기 때문에 자원에 접근할 수 있다.
- 사용자 모드로 실행되던 프로그램이 운영체제 서비스를 제공 받기 위해서는 커널 모드로 전환해야 하는데, 전환하기 위한 요청을 시스템 호출(system call) 이라고 한다.
- 시스템 호출은 소프트웨어적인 인터럽트이다. 인터럽트는 입출력 장치에 의해 발생하기도 하지만 **인터럽트를 실행하기 위한 특정한 명령어**에 의해서 발생하기도 하는데, 이것을 소프트웨어 인터럽트라고 한다.
    - 시스템 호출 실행 과정: 명령어 실행 → CPU 에서 기존 작업 백업 → 인터럽트 서비스 루틴 실행 → 응용 프로그램으로 복귀

## 운영체제의 핵심 서비스

### 프로세스 관리

- 실행 중인 프로그램을 프로세스라고 한다. 컴퓨터를 실행하게 되면 새로운 프로세스들이 메모리 안에서 생성되고, 사용하지 않는 프로세스는 메모리에서 삭제된다.
- 일반적으로 하나의 CPU 는 한 번에 하나의 프로세스만 실행할 수 있다. 따라서 CPU 는 프로세스들을 전환하면서 실행한다.

### 자원 접근 및 할당

- **CPU**: 하나의 프로세스가 실행되면 나머지 프로세스는 기다려야 하는데, 운영체제는 프로세스들에 공정하게 CPU 를 할당한다. 그리고 이것을 CPU 스케쥴링이라고 한다.
- **메모리**: 메모리에 적재된 프로세스들은 크키와 주소가 가지각색이다. 그리고 메모리가 이미 꽉 차 있어서 반드시 실행해야 할 프로세스를 적재할 공간이 없는 경우도 있다.
- **입출력 장치**: 인터럽트 서비스 루틴은 운영체제가 제공하는 기능으로 커널 영역에 있다. 운영체제가 인터럽트 서비스 루틴을 제공하여 입출력 작업을 수행한다.

### 파일 시스템 관리

- 파일들을 디렉토리에 묶어 관리하는데, 이런 파일 시스템도 운영체제가 지원하는 핵심 서비스이다.

## 가상 머신과 이중 모드의 발전

- 가상 머신이란 소프트웨어적으로 만들어낸 가상의 컴퓨터이다.
- 가상 머신에 설치된 운영체제도 사용자 모드로 작동하면 운영체제 서비스를 제공받기 힘들기 때문에 가상화를 지원하는 CPU 는 커널/사용자 모드 이외에 가상 머신을 위한 모드인 하이퍼 바이저 모드를 따로 둔다. 즉, 가상 머신 상에서 작동하는 응용 프로그램들은 하이퍼바이저 모드로써 가상 머신에 설치된 운영체제로부터 운영체제 서비스를 받을 수 있다.
