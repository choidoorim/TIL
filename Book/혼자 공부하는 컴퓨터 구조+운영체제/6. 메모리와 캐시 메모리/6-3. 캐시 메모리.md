# 6-3. 캐시 메모리

- CPU 가 연산을 하는 속도보다 CPU 가 메모리에 접근하는 시간이 더 오래 걸린다. 따라서 아무리 연산속도가 빠르다해도 메모리에 접근하는 시간이 느리다면 CPU 연산속도가 빠른게 의미가 없다. 이를 극복하기 위한 저장장치가 캐시 메모리다.

## 저장 장치 계층 구조

- CPU 와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느리다. 그리고 속도가 빠른 저장 장치는 저장 용량이 작고, 가격이 비싸다.
    - 레지스터와 RAM 중 레지스터가 용량은 작지만 속도는 압도적으로 빠르고 가격이 비싸다.
    - USB 메모리보다 RAM 이 접근 시간이 훨씬 빠르지만, 가격은 더 비싸다.
- 컴퓨터가 사용하는 저장 장치들은 CPU 에 얼마나 가까운가를 기준으로 계층적으로 나타낼 수 있고, 이것을 **저장 장치 계층 구조(memory hierarchy)** 라고 한다. memory 는 RAM 이 아닌 일반적인 저장 장치를 의미한다.

  ![메모리계층구조그림1](https://github.com/choidoorim/TIL/assets/63203480/15c6d7a9-bce8-4c9a-9acf-9094e9d36b67)


## 캐시 메모리

- CPU 와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치이다.
- 캐시 메모리는 CPU 의 연산 속도와 메모리 접근 속도의 차이를 줄이기 위해 만들어졌다. CPU 에서 메모리에 접근하는 것은 비교적 느리기 때문에 **메모리에서 CPU 가 사용할 데이터를 미리 캐시 메모리에 가지고 오는 것**이다.
- 컴퓨터 내부에는 여러 개의 캐시 메모리가 있다. **CPU 와 가까운 순서대로 L1/L2/L3 캐시**라고 부르며 계층을 구성한다.

  ![다운로드](https://github.com/choidoorim/TIL/assets/63203480/c70ec8b5-4f8e-4240-940c-475afeefd97a)

  CPU 가 메모리에 데이터가 필요하다고 판단다면 L1 부터 L3 까지 순차적으로 데이터를 검색한다.

- 멀티 코어 프로세서에서 L1 과 L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고, L3 캐시는 여러 코어가 공유하는 형태로 사용된다.
- L1 캐시도 명령어만을 저장하는 L1l 캐시와 데이터만을 저장하는 L1D 캐시로 분리하는 경우도 있다. 그리고 이것을 분리형 캐시(split cache)라고 한다.

## 참조 지역성 원리

- 캐시 메모리는 메모리보다 용량이 적기 때문에 메모리의 모든 내용을 저장하고 있을 수 없다. 그렇기 때문에 캐시메모리는 메모리의 일부를 복사하여 저장한다.
- 자주 사용될 것으로 **예측한 데이터가 실제로 들어맞아** 캐시 메모리 내 데이터가 CPU 에서 활용될 경우를 캐시 히트(Cache Hit) 라고 한다. 반대로 자주 사용될 것으로 예측했지만 예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야 하는 경우를 캐시 미스(Cache Miss) 라고 한다.
- 캐시 히트되는 비율을 캐시 적중률(Cache Hit Ratio) 라고 한다. 그리고 “`캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)` ” 이렇게 계산한다.
- CPU 가 사용할 법한 데이터를 알기 위해서 **캐시 메모리는 참조 지역성의 원리에 따라 메모리로부터 가져올 데이터를 결정**한다. 참조 지역성의 원리란 CPU 가 메모리에 접근할 때의 주된 경향을 바탕으로 만들어진 원리이다.

### 참조 지역성 원리 1 - 최근에 접근했던 메모리 공간에 다시 접근하려는 경향

- 프로그램에서는 변수가 저장된 메모리 공간을 한 번만 사용하지 않고 프로그램이 실행되는 동안 여러 번 사용된다. 즉, CPU 는 최근에 접근했던 메모리 공간을 여러 번 다시 접근할 수 있다.
- **최근에 접근했던 메모리 공간에 다시 접근하려는 경향을 시간 지역성(temporal locality)**라고 한다.

### 참조 지역성 원리 2 - 접근한 메모리 공간 근처를 접근하려는 경향

- CPU 가 실행하려는 프로그램은 보통 관련 데이터들끼리 모여있다. 그리고 프로그램 내에서도 관련 있는 데이터들은 모여서 저장된다. **접근한 메모리 공간 근처를 접근하려는 경향을 공간 지역성(spatial locality)**이라고 한다.
    - 예를 들어, 워드 프로세서 프로그램을 실행할 때는 워드 프로세서 프로그램이 모여 있는 공간 근처를 집중적으로 접근할 것이고, 사용자가 입력 기능을 사용할 때는 입력 기능이 모여 있는 공간 근처를 집중적으로 접근할 것이다.
