# NodeJS Event Loop
## NodeJS 란?
공식 사이트에서 확인해보면 **"Node.js는 Chrome V8 JavaScript 엔진으로 빌드된 JavaScript 런타임입니다"** 라고 되어있습니다.     
NodeJS 의 대표적인 특징은 비동기, 이벤트 기반, 싱글스레드, Non Blocking, 확장성 등이 있습니다.

우선 Javascript 의 동작원리를 먼저 알아야 합니다.

### Javascript 동작원리

Javascript 는 싱글스레드 기반 콜백 큐를 사용합니다.

![javascript 동작원리](https://user-images.githubusercontent.com/63203480/145023953-b2b0a7f8-49f0-48e4-9a04-da1b62490ed7.png)

위의 그림처럼 Javascript 는 **메모리 힙과 콜 스택**으로 구성되어 있습니다.    
메모리 힙은 메모리 할당이 일어나는 곳이고 콜 스택은 코드가 실행됨에 따라 호출 스택이 쌓이는 곳입니다.

Javascript 는 싱글 스레드기반이기 때문에 하나의 메인 스레드와 하나의 콜 스택을 가지고 있습니다. 즉, 한 번에 한 작업만 처리할 수 있는 것입니다.

#### 콜 스택(Call Stack)
콜 스택은 기본적으로 우리가 프로그램 상에서 어디에 있는지를 기록하는 자료구조입니다. 
함수를 실행하게 되면 해당ㅇ 함수는 콜 스택의 가장 상단에 위치하게 되고, 함수의 실행이 끝날 때 콜 스택에서 제거합니다.


### Javascript 런타임
Javascript 에서 자체적으로 비동기를 지원하지는 않습니다. 
비동기, 논블로킹 작업들은 Javascript 엔진을 구동하는 브라우저나 NodeJS 같은 **런타임 환경에서 담당**합니다.

런타임이란 프로그램이 실행되고 있을 때 존재하는 곳을 의미합니다. 런타임 환경이란 프로그램들을 실행할 수 있는 환경을 뜻합니다.     
즉, NodeJS 는 기존 웹 상에서만 동작하는 Javascript 를 웹 상이 아닌 곳에도 실행시킬 수 있도록 도와주는 실행기 입니다.


## NodeJS 구조
구조를 살펴보기 전에 NodeJS 의 대표적인 특징들에 대해서 한 번 살펴봅시다.

### 1. 싱글스레드
싱글스레드는 프로세스 내에서 요청이 있을 경우 하나의 스레드가 하나의 요청만을 수행합니다. 
해당 요청이 수행될 때는 다른 요청을 함께 수행할 수 없습니다. 이를 싱글스레드 블로킹 모델이라고 합니다.

NodeJS 는 싱글스레드 논블로킹 모델로 구성되어 있습니다. 하나의 스레드로 동작하지만, 비동기 처리를 통해 요청들을 서로 블로킹하지 않습니다.
즉, 많은 요청들을 비동기로 수행함으로써 싱글스레드지만 논블로킹이 가능합니다.

### 2. 확장성
NodeJS 는 클러스터링이라는 기능을 통해 싱글스레드인 노드가 CPU 를 모두 사용해서 작업들을 병렬적으로 처리할 수 있게 해줍니다.
즉, 싱글스레드이지만 멀티스레드처럼 사용하여 서버의 확장성이 용이하다는 장점을 갖게 됩니다.

### 3. 이벤트 기반
이벤트 기반이란 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미합니다. 
NodeJS 는 이벤트 리스너에 미리 등록해놓은 콜백함수를 실행하는 방식으로 동작합니다.     
이벤트 리스너란 이벤트가 발생했을 때 그 처리를 담당하는 함수입니다.

```javascript
router.get('/', (req, res, next) => {
    // router.get 이벤트에 대한 콜백함수 로직
})
```

우리가 흔히 사용하는 router 도 이벤트 기반으로 동작하고 있습니다.      
그렇다면 이벤트 루프란 무엇일까요?    
**이벤트 루프란 이벤트에 따라 호출되는 콜백함수를 관리하는 것**입니다.

![nodejs구조](https://user-images.githubusercontent.com/63203480/145205498-075e0ff4-b4e7-4f0a-b6e2-9395d0eead56.png)

NodeJS 는 Javascript 와 C++ 언어로 구성되어 있습니다. V8 엔진도 70% 이상이 C++ 로 구성되어 있으며, libuv 는 100% C++ 언어로 구성된 라이브러리 입니다.  

```
libuv : NodeJS 에서 비동기 처리가 가능하도록 해주는 라이브러리
v8 : Javascript 엔진으로써 자바스크립트를 실행하는 라이브러리
```

NodeJS 에서 동작하는 이벤트 루프는 libuv 내에서 구현됩니다. 


## NodeJS Event Loop
NodeJS 는 싱글 스레드 논블로킹입니다. NodeJS 는 하나의 스레드로 동작하지만 이벤트가 발생할 경우 이를 **비동기적으로 처리**가 가능합니다.     
NodeJS 는 하나의 스레드만으로 여러 비동기 작업들을 블로킹 없이(논블로킹) 수행이 가능하고 그것이 가능한 것은 이벤트 루프가 존재하기 때문입니다.



