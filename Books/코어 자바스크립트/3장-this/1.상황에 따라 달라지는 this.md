# 1. 상황에 따라 달라지는 this

함수와 객체 간의 구분이 느슨한 자바스크립트에서 this 는 이 둘을 구분하는 거의 유일한 기능이다.

자바스크립트에서 this 는 기본적으로 실행 컨텍스트가 생성될 때 함께 결정된다. **실행 컨텍스트는 함수를 호출할 때 생성되기 때문에 this 도 함수를 호출할 때 결정**된다고 할 수 있다. 함수를 어떤 방식으로 호출하냐에 따라 값도 달라진다.

## 1. 전역 공간에서의 this

전역 공간에서의 this 는 전역 객체를 뜻한다. 전역 객체는 자바스크립트의 런타임 환경에 따라 다른 이름과 정보를 가지고 있다. 브라우저 환경에서의 전역 객체는 `window` 이며, NodeJS 환경에서는 `global` 이다.

전역 변수를 선언하면 자바스크립트 엔진은 이를 전역 객체의 프로퍼티로도 할당한다. 변수이면서 객체의 프로퍼티이기도 한 것이다.

```jsx
var a = 1;

console.log(a); // 1
console.log(global.a); // 1
console.log(this.a); // 1
```

전역공간에 선언한 변수 a 에 1이라는 값을 할당했을 뿐인데 `global.a` 와 `this.a` 모두 1이 출력된다. 전역 공간에서의 `this` 는 전역객체를 의미하기 때문에 `global.a` 와 `this.a` 두 값이 같은 값을 출력하는 것은 당연하지만 왜 그 값이 1일까? **자바스크립트의 모든 변수는 사실 특정 객체 프로퍼티로서 동작**하기 때문이다. 사용자가 var 를 통해 변수를 선언하더라도 실제로 자바스크립트 엔진은 어떤 특정 객체의 프로퍼티로 인식하는 것이다. 이때 **특정 객체란 실행 컨텍스트의 LexicalEnvironment** 이다.

실행 컨텍스트는 변수를 수집해서 LexicalEnvironment 의 프로퍼티로 저장한다. 어떤 변수를 호출할 때 LexicalEnvironment 를 조회해서 일치되는 프로퍼티가 있을 경우 그 값을 반환한다.

**전역 컨텍스트의 경우에는 LexicalEnvironment 는 전역 객체를 그대로 참조**한다. 정확히는 GlobalEnv 가 전역 객체를 참조하는데 전역 컨텍스트의 LexicalEnvironment 가 GlobalEnv 를 참조한다.

“전역 변수를 선언하면 자바스크립트 엔진은 이를 전역 객체의 프로퍼티로 할당한다” 라는 것이 더 맞는 표현이다.

그렇다면 전역 공간에서는 변수를 선언하는 것 대신에 global(window) 프로퍼티에 직접 할당해도 똑같이 동작할 것이라고 생각할 수 있다. 대부분의 경우에는 맞는말이다.

```jsx
global.age = 1;
console.log(age); // 1
```

그런데 전역 변수 선언과 전역 객체 프로퍼티 할당 사이에 차이점이 있는데 그것은 바로 **삭제**할 경우이다.

```jsx
var a = 1;
delete global.a; // fail
console.log(a, global.a, this.a); // 1, 1, 1

var b = 2;
delete b; // fail
console.log(b, global.b, this.b); // 2, 2, 2
```

```jsx
global.c = 3;
delete global.c; // success
console.log(c, global.c, this.c); // error - c is not defined

global.d = 4;
delete d; // success
console.log(d, global.d, this.d); // // error - d is not defined
```

변수에 delete 연산을 사용하는 것은 이상해보일 수 있는데 `global.` 을 생략한 것으로 이해할 수 있다. 전역변수가 곧 전역 객체의 프로퍼티이므로 문제가 되지 않는다.

하지만 예제를 보면 전역 객체의 프로퍼티로 할당 한 경우에는 삭제되는 반면 전역 변수로 선언한 경우에는 삭제가 되지 않는다. 이것은 **사용자가 의도치않게 삭제하는 것을 방지하기 위한 방어 전략**이다. 즉, 자바스크립트 엔진에서 전역 변수로 선언된 경우에는 전역객체의 프로퍼티로 자동 할당하지만 추가적으로 해당 프로퍼티의 configurable 속성을 false 로 정의한다.

```
ChatGPT

자바스크립트에서 this와 global은 다른 것을 나타냅니다.

this는 함수가 호출되는 컨텍스트에 따라 값이 달라집니다. this는 현재 실행 중인 함수를 호출한 객체를 참조합니다. 함수가 어디서 호출되는지에 따라 this 값이 변경될 수 있습니다. 예를 들어, 객체의 메서드로 함수가 호출되면 this는 그 객체를 참조하게 됩니다. 하지만, 일반 함수 내에서 this를 사용할 경우, this는 전역 객체를 참조하게 됩니다.

반면에, global은 노드(Node.js)에서 전역 객체를 나타냅니다. 브라우저에서는 전역 객체를 window로 나타냅니다. global 객체는 모든 모듈에서 참조할 수 있으며, 전역 변수와 함수를 정의할 수 있습니다.

따라서, this는 함수가 호출되는 컨텍스트에 따라 값이 변하는 것에 반해, global은 전역 객체를 나타내는 것입니다.
```

## 2. 메서드로 호출할 때 그 메서드 내부에서의 this

### 함수 vs 메서드

어떤 함수를 실행하는 방법은 2 가지가 있는데, 함수로 호출하는 경우와 메서드로 호출하는 경우이다.
