# 1. 클로저의 의미 및 원리 이해

클로저는 함수형 프로그래밍에서 등장하는 보편적인 특성이다. 자바스크립트의 고유 개념은 아니기에 ECMAScript 명세에서도 클로저의 정의를 다루지 않고 있다.

MDN 에서는 클로저를 “클로저는 함수와 그 함수가 선언될 당시에 lexical environment 의 상호관계에 따른 현상” 이라고 한다.

“~선언될 당시에 lexical environment” 라는 것은 실행 컨텍스트의 요소 중 하나인 outerEnvironmentReference 에 해당한다.

- LexicalEnvironment 의 environmentRecord 와 outerEnvironmentReference 에 의해 변수의 유효범위인 스코프가 결정되고, 스코프체인이 가능해진다.

```jsx
function A() {
  //...
  function B() {
    //...
  }
}
```

어떤 컨텍스트 A 에서 선언한 내부함수 B 의 실행 컨텍스트가 활성화되는 시점에는 B 의 outerEnvironmentReference 가 참조하는 대상인 A 의 LexicalEnvironment 에도 접근이 가능하게 된다. 즉, A 에서는 B 에서 선언한 변수에 접근할 수 없지만, B 에서는 A 에서 선언한 변수에 접근이 가능하다는 것이다.

```jsx
var outer = function () {
  var a = 1;
  var inner = function () {
    console.log(a++);
  }
  inner();
};
outer();
```

`inner` 함수 내부에서는 `a` 를 선언하지 않았기 때문에 environmentRecord 에서 값을 찾지 못하므로 outerEnvironmentReference 에 지정된 상위 컨텍스트인 `outer` 의 LexicalEnvironment 에 접근해서 `a` 를 찾는다. `outer` 함수의 실행이 종료되면 LexicalEnvironment 에 저장된 식별자들(`a, inner`) 에 대한 참조를 지운다. 각 주소에 저장되어있던 값들은 자신을 참조하는 변수가 하나도 없게되어 가비지 컬렉터의 수집대상이 된다.

```jsx
var outer = function () {
  var a = 1;
  var inner = function () {
    return ++a;
  }
  return inner();
};
var outer2 = outer();
console.log(outer2);
```
