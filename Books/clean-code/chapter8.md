# 8장 - 경계

시스템에 들어가는 모든 소프트웨어를 직접 개발하는 경우는 드물다. 따라서 외부 코드를 우리 코드에 깔끔하게 통합해야 한다.

## 외부코드 사용하기

Java 의 Map 은 다양한 인터페이스로 수많은 기능을 제공한다.

```tsx
public class Sensors {
	private Map sensors = new HashMap();
	
	public Sensor getById(String id) {
		return (Sensor) sensors.get(id);
	}
	//...
}
```

경계 인터페이스인 Map 을 Sensors 안으로 숨긴다. 따라서 Map 인터페이스가 변하더라도 나머지 프로그램에는 영향을 미치지 않게 된다.

Map 클래스를 사용할 때마다 위와 같은 캡슐화를 진행하라는 것은 아니다. Map이나 유사한 경계 인터페이스를 여러 메서드들에게 넘겨서 사용하지 말라는 것이다.

Map 과 같은 경계 인터페이스를 사용할 때는 이를 이용하는 클래스나 클래스 계열 밖으로 노출되지 않도록 주의해야 한다.

## 경계 살피고 익히기

우리 코드에 외부 코드를 호출하는 대신 먼저 간단한 테스트 케이스를 작성해 외부 코드를 읽히는 것을 **학습 테스트** 라고 한다.

학습 테스트는 프로그램에서 사용하려는 방식대로 외부 API 를 호출한다. 통제된 환경에서 API 를 제대로 이해하고 있는지 확인하는 것이다.

## 학습 테스트는 공짜 이상이다

학습테스트는 필요한 지식만 확보할 수 있는 방법이며 이해도를 높여주는 정확한 실험이다.

패키지의 새 버전이 출시된다면 학습 테스트를 돌려 차이가 있는지 확인한다. 또한 패키지가 예상대로 동작하는지 검증이 된다. 섣불리 코드를 통합하여 사용한다고 해도 우리 코드와 호환이 되는지 확인하기 힘들다. 패키지의 새 버전이 나올때마다 새로운 위험이 생긴다. 만약 새 버전이 우리 코드와 호환되지 않는다면 학습 테스트는 이 사실을 바로 알아챌 수 있다.

## 아직 존재하지 않는 코드를 사용하기

아는 코드와 모르는 코드를 분리하는 경계가 있다. 때로는 우리 지식이 경계를 넘어서 미치지 못하는 코드 영역도 있다.

우리가 바라는 인터페이스를 구현하면 우리가 인터페이스를 전적으로 통제할 수 있는 장점이 있다. 또한 코드의 가독성도 높아지고 코드 의도도 분명해진다. 즉, 아직 존재하지 않아 알 수 없는 기능을 인터페이스로 구현하는 것이다.

이러한 설계는 테스트도 아주 편하다. 적절한 Fake 클래스를 사용해서 테스트가 가능하기 때문이다.

## 깨끗한 경계

경계에 위치하는 코드는 깔끔히 분리해야 한다. 또한 기대치를 정의하는 테스트 케이스도 작성한다.

통제가 불가능한 외부 패키지에 의존하기보다는 통제가 가능한 우리 코드에 의존하는 것이 훨씬 좋다. 잘못하면 외부 코드에 휘둘리기 때문이다.

외부 패키지를 호출하는 코드를 가능한 줄여서 경계를 관리해야 한다. 새로운 클래스로 경계를 감싸거나 Adapter 패턴을 사용해 우리가 원하는 인터페이스를 패키지가 제공하는 인터페이스로 변환해야 한다.
