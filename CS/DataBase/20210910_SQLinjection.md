> **SQL Injection 이란?**

해커에 의해 조작된 SQL 문이 DB에 그대로 전달되어 비정상적인 명령을 실행시키는 공격 기법입니다.

> **공격 방법**

**1\. 인증 우회**

아이디와 패스워드를 입력하는 로그인 페이지를 타겟으로 행해지는 공격입니다. 보통 로그인을 할 때, 아이디와 비밀번호를 input 창에 입력하게 됩니다. 아이디가 durumi, 비밀번호가 1234 일 때 쿼리는 아래와 같이 실행될 것입니다.

```mysql
SELECT * FROM USER WHERE ID = 'durumi' AND PASSWORD = '1234';
```

SQL Injection 으로 공격할 때는 input 창에 비밀번호를 입력함과 동시에 다른 쿼리문을 함께 입력하는 것입니다.

```mysql
SELECT * FROM USER WHERE ID = 'durumi' AND PASSWORD = '1234';
DELETE * USER FROM ID = '1';
```

보안이 완벽하지 않을 경우는 이처럼 비밀번호가 아이디와 일치해서 True가 되고 뒤에 작성한 DELETE 문도 데이터베이스에 영향을 줄 수도 있게 되는 치명적인 상황이 발생합니다.

또한 쿼리문의 WHERE 절에 OR 문을 추가하여 '1 = 1'과 같은 true 문을 작성하여 무조건 적용되도록 수정한 뒤 데이터베이스를 마음대로 조작할 수도 있습니다.

```mysql
SELECT * FROM USER WHERE ID = 'durumi' AND PASSWORD = '1234' OR 1=1 ~~;
```

**2\. 데이터 노출**

시스템에서 발생하는 **에러 메시지를 이용해 공격하는 방법**으로 보통 에러는 개발자가 버그를 수정하는 면에서 도움을 받을 수 있는 것입니다. 하지만 해커들은 이를 역이용해서 악의적인 쿼리를 삽입하여 에러를 유발시킵니다.

예를 들면, 해커는 GET 방식으로 동작하는 URL 쿼리 스트링을 추가하여 에러를 발생시킵니다. 이에 해당하는 오류가 발생하면 해당 에러 메시지를 통해 해당 시스템의 데이터베이스의 구조를 유추할 수 있고 해킹에 활용하게 됩니다.

> **방어 방법**

**1\. Input 값을 받을 때, 특수문자 여부 체크하기**

아이디와 패스워드를 입력받을 때 입력에 **특수문자가 포함되어 있는지에 대한 검증 로직을 추가**하여 요청이 들어왔을 때 막아낼 수 있습니다.

**2\. SQL 서버 오류 발생 시, 해당하는 에러 메시지 감추기**

테이블에서는 모든 정보를 가지고 있지만, View를 사용하면 테이블의 일부만 보일 수 있고 **접근 권한을 다르게** 할 수도 있습니다. 따라서 원본 테이블에는 접근권한을 높이고, 일반 사용자는 view로만 접근하도록 하면 원본 테이블이 공격에 의해 노출되는 정도를 줄일 수 있습니다.

**3\. preparestatement 사용하기**

Mysql의 Preparedstatement 구문을 사용하면 특수문자를 자동으로 escaping 해줍니다. 클라이언트 측 자바스크립트로 입력 값을 우선 검증하고 서버 측에서 입력 값을 한번 더 필터링 합니다.

```mysql
SELECT * FROM USER WHERE ID = ? AND PASSWORD = ?;
```

**4\. Hash function 사용하기**

사용자의 입력 값을 데이터베이스에 그대로 저장하고 사용하지 말아야합니다. 특히 비밀번호같은 경우에는 무조건 **SHA-256 이상의 보안성을 갖는 해시함수로 해싱한 뒤 저장**해야 합니다.